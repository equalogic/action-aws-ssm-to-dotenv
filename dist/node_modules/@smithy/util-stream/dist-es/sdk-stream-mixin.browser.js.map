{"version":3,"file":"sdk-stream-mixin.browser.js","sources":["../../../../../node_modules/@smithy/util-stream/dist-es/sdk-stream-mixin.browser.js"],"sourcesContent":["import { streamCollector } from \"@smithy/fetch-http-handler\";\nimport { toBase64 } from \"@smithy/util-base64\";\nimport { toHex } from \"@smithy/util-hex-encoding\";\nimport { toUtf8 } from \"@smithy/util-utf8\";\nimport { isReadableStream } from \"./stream-type-check\";\nconst ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED = \"The stream has already been transformed.\";\nexport const sdkStreamMixin = (stream) => {\n    if (!isBlobInstance(stream) && !isReadableStream(stream)) {\n        const name = stream?.__proto__?.constructor?.name || stream;\n        throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${name}`);\n    }\n    let transformed = false;\n    const transformToByteArray = async () => {\n        if (transformed) {\n            throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n        }\n        transformed = true;\n        return await streamCollector(stream);\n    };\n    const blobToWebStream = (blob) => {\n        if (typeof blob.stream !== \"function\") {\n            throw new Error(\"Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.\\n\" +\n                \"If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body\");\n        }\n        return blob.stream();\n    };\n    return Object.assign(stream, {\n        transformToByteArray: transformToByteArray,\n        transformToString: async (encoding) => {\n            const buf = await transformToByteArray();\n            if (encoding === \"base64\") {\n                return toBase64(buf);\n            }\n            else if (encoding === \"hex\") {\n                return toHex(buf);\n            }\n            else if (encoding === undefined || encoding === \"utf8\" || encoding === \"utf-8\") {\n                return toUtf8(buf);\n            }\n            else if (typeof TextDecoder === \"function\") {\n                return new TextDecoder(encoding).decode(buf);\n            }\n            else {\n                throw new Error(\"TextDecoder is not available, please make sure polyfill is provided.\");\n            }\n        },\n        transformToWebStream: () => {\n            if (transformed) {\n                throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n            }\n            transformed = true;\n            if (isBlobInstance(stream)) {\n                return blobToWebStream(stream);\n            }\n            else if (isReadableStream(stream)) {\n                return stream;\n            }\n            else {\n                throw new Error(`Cannot transform payload to web stream, got ${stream}`);\n            }\n        },\n    });\n};\nconst isBlobInstance = (stream) => typeof Blob === \"function\" && stream instanceof Blob;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAKA,MAAM,mCAAmC,GAAG,0CAA0C;AAC1E,MAAC,cAAc,GAAG,CAAC,MAAM,KAAK;AAC1C,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE;AAC9D,QAAQ,MAAM,IAAI,GAAG,MAAM,EAAE,SAAS,EAAE,WAAW,EAAE,IAAI,IAAI,MAAM;AACnE,QAAQ,MAAM,IAAI,KAAK,CAAC,CAAC,qEAAqE,EAAE,IAAI,CAAC,CAAC,CAAC;AACvG,IAAI;AACJ,IAAI,IAAI,WAAW,GAAG,KAAK;AAC3B,IAAI,MAAM,oBAAoB,GAAG,YAAY;AAC7C,QAAQ,IAAI,WAAW,EAAE;AACzB,YAAY,MAAM,IAAI,KAAK,CAAC,mCAAmC,CAAC;AAChE,QAAQ;AACR,QAAQ,WAAW,GAAG,IAAI;AAC1B,QAAQ,OAAO,MAAM,eAAe,CAAC,MAAM,CAAC;AAC5C,IAAI,CAAC;AACL,IAAI,MAAM,eAAe,GAAG,CAAC,IAAI,KAAK;AACtC,QAAQ,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,UAAU,EAAE;AAC/C,YAAY,MAAM,IAAI,KAAK,CAAC,kGAAkG;AAC9H,gBAAgB,0IAA0I,CAAC;AAC3J,QAAQ;AACR,QAAQ,OAAO,IAAI,CAAC,MAAM,EAAE;AAC5B,IAAI,CAAC;AACL,IAAI,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE;AACjC,QAAQ,oBAAoB,EAAE,oBAAoB;AAClD,QAAQ,iBAAiB,EAAE,OAAO,QAAQ,KAAK;AAC/C,YAAY,MAAM,GAAG,GAAG,MAAM,oBAAoB,EAAE;AACpD,YAAY,IAAI,QAAQ,KAAK,QAAQ,EAAE;AACvC,gBAAgB,OAAO,QAAQ,CAAC,GAAG,CAAC;AACpC,YAAY;AACZ,iBAAiB,IAAI,QAAQ,KAAK,KAAK,EAAE;AACzC,gBAAgB,OAAO,KAAK,CAAC,GAAG,CAAC;AACjC,YAAY;AACZ,iBAAiB,IAAI,QAAQ,KAAK,SAAS,IAAI,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,OAAO,EAAE;AAC5F,gBAAgB,OAAO,MAAM,CAAC,GAAG,CAAC;AAClC,YAAY;AACZ,iBAAiB,IAAI,OAAO,WAAW,KAAK,UAAU,EAAE;AACxD,gBAAgB,OAAO,IAAI,WAAW,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC;AAC5D,YAAY;AACZ,iBAAiB;AACjB,gBAAgB,MAAM,IAAI,KAAK,CAAC,sEAAsE,CAAC;AACvG,YAAY;AACZ,QAAQ,CAAC;AACT,QAAQ,oBAAoB,EAAE,MAAM;AACpC,YAAY,IAAI,WAAW,EAAE;AAC7B,gBAAgB,MAAM,IAAI,KAAK,CAAC,mCAAmC,CAAC;AACpE,YAAY;AACZ,YAAY,WAAW,GAAG,IAAI;AAC9B,YAAY,IAAI,cAAc,CAAC,MAAM,CAAC,EAAE;AACxC,gBAAgB,OAAO,eAAe,CAAC,MAAM,CAAC;AAC9C,YAAY;AACZ,iBAAiB,IAAI,gBAAgB,CAAC,MAAM,CAAC,EAAE;AAC/C,gBAAgB,OAAO,MAAM;AAC7B,YAAY;AACZ,iBAAiB;AACjB,gBAAgB,MAAM,IAAI,KAAK,CAAC,CAAC,4CAA4C,EAAE,MAAM,CAAC,CAAC,CAAC;AACxF,YAAY;AACZ,QAAQ,CAAC;AACT,KAAK,CAAC;AACN;AACA,MAAM,cAAc,GAAG,CAAC,MAAM,KAAK,OAAO,IAAI,KAAK,UAAU,IAAI,MAAM,YAAY,IAAI;;;;","x_google_ignoreList":[0]}