{"version":3,"file":"memoizeIdentityProvider.js","sources":["../../../../../../node_modules/@smithy/core/dist-es/util-identity-and-auth/memoizeIdentityProvider.js"],"sourcesContent":["export const createIsIdentityExpiredFunction = (expirationMs) => (identity) => doesIdentityRequireRefresh(identity) && identity.expiration.getTime() - Date.now() < expirationMs;\nexport const EXPIRATION_MS = 300000;\nexport const isIdentityExpired = createIsIdentityExpiredFunction(EXPIRATION_MS);\nexport const doesIdentityRequireRefresh = (identity) => identity.expiration !== undefined;\nexport const memoizeIdentityProvider = (provider, isExpired, requiresRefresh) => {\n    if (provider === undefined) {\n        return undefined;\n    }\n    const normalizedProvider = typeof provider !== \"function\" ? async () => Promise.resolve(provider) : provider;\n    let resolved;\n    let pending;\n    let hasResult;\n    let isConstant = false;\n    const coalesceProvider = async (options) => {\n        if (!pending) {\n            pending = normalizedProvider(options);\n        }\n        try {\n            resolved = await pending;\n            hasResult = true;\n            isConstant = false;\n        }\n        finally {\n            pending = undefined;\n        }\n        return resolved;\n    };\n    if (isExpired === undefined) {\n        return async (options) => {\n            if (!hasResult || options?.forceRefresh) {\n                resolved = await coalesceProvider(options);\n            }\n            return resolved;\n        };\n    }\n    return async (options) => {\n        if (!hasResult || options?.forceRefresh) {\n            resolved = await coalesceProvider(options);\n        }\n        if (isConstant) {\n            return resolved;\n        }\n        if (!requiresRefresh(resolved)) {\n            isConstant = true;\n            return resolved;\n        }\n        if (isExpired(resolved)) {\n            await coalesceProvider(options);\n            return resolved;\n        }\n        return resolved;\n    };\n};\n"],"names":[],"mappings":"AAAY,MAAC,+BAA+B,GAAG,CAAC,YAAY,KAAK,CAAC,QAAQ,KAAK,0BAA0B,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG;AACxJ,MAAC,aAAa,GAAG;AACjB,MAAC,iBAAiB,GAAG,+BAA+B,CAAC,aAAa;AAClE,MAAC,0BAA0B,GAAG,CAAC,QAAQ,KAAK,QAAQ,CAAC,UAAU,KAAK;AACpE,MAAC,uBAAuB,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,eAAe,KAAK;AACjF,IAAI,IAAI,QAAQ,KAAK,SAAS,EAAE;AAChC,QAAQ,OAAO,SAAS;AACxB,IAAI;AACJ,IAAI,MAAM,kBAAkB,GAAG,OAAO,QAAQ,KAAK,UAAU,GAAG,YAAY,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,QAAQ;AAChH,IAAI,IAAI,QAAQ;AAChB,IAAI,IAAI,OAAO;AACf,IAAI,IAAI,SAAS;AACjB,IAAI,IAAI,UAAU,GAAG,KAAK;AAC1B,IAAI,MAAM,gBAAgB,GAAG,OAAO,OAAO,KAAK;AAChD,QAAQ,IAAI,CAAC,OAAO,EAAE;AACtB,YAAY,OAAO,GAAG,kBAAkB,CAAC,OAAO,CAAC;AACjD,QAAQ;AACR,QAAQ,IAAI;AACZ,YAAY,QAAQ,GAAG,MAAM,OAAO;AACpC,YAAY,SAAS,GAAG,IAAI;AAC5B,YAAY,UAAU,GAAG,KAAK;AAC9B,QAAQ;AACR,gBAAgB;AAChB,YAAY,OAAO,GAAG,SAAS;AAC/B,QAAQ;AACR,QAAQ,OAAO,QAAQ;AACvB,IAAI,CAAC;AACL,IAAI,IAAI,SAAS,KAAK,SAAS,EAAE;AACjC,QAAQ,OAAO,OAAO,OAAO,KAAK;AAClC,YAAY,IAAI,CAAC,SAAS,IAAI,OAAO,EAAE,YAAY,EAAE;AACrD,gBAAgB,QAAQ,GAAG,MAAM,gBAAgB,CAAC,OAAO,CAAC;AAC1D,YAAY;AACZ,YAAY,OAAO,QAAQ;AAC3B,QAAQ,CAAC;AACT,IAAI;AACJ,IAAI,OAAO,OAAO,OAAO,KAAK;AAC9B,QAAQ,IAAI,CAAC,SAAS,IAAI,OAAO,EAAE,YAAY,EAAE;AACjD,YAAY,QAAQ,GAAG,MAAM,gBAAgB,CAAC,OAAO,CAAC;AACtD,QAAQ;AACR,QAAQ,IAAI,UAAU,EAAE;AACxB,YAAY,OAAO,QAAQ;AAC3B,QAAQ;AACR,QAAQ,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;AACxC,YAAY,UAAU,GAAG,IAAI;AAC7B,YAAY,OAAO,QAAQ;AAC3B,QAAQ;AACR,QAAQ,IAAI,SAAS,CAAC,QAAQ,CAAC,EAAE;AACjC,YAAY,MAAM,gBAAgB,CAAC,OAAO,CAAC;AAC3C,YAAY,OAAO,QAAQ;AAC3B,QAAQ;AACR,QAAQ,OAAO,QAAQ;AACvB,IAAI,CAAC;AACL;;;;","x_google_ignoreList":[0]}