import { debugId } from '../debug/debugId.js';
import { toDebugString } from '../debug/toDebugString.js';
import { evaluateConditions } from './evaluateConditions.js';
import { getEndpointHeaders } from './getEndpointHeaders.js';
import { getEndpointProperties } from './getEndpointProperties.js';
import { getEndpointUrl } from './getEndpointUrl.js';

const evaluateEndpointRule = (endpointRule, options) => {
    const { conditions, endpoint } = endpointRule;
    const { result, referenceRecord } = evaluateConditions(conditions, options);
    if (!result) {
        return;
    }
    const endpointRuleOptions = {
        ...options,
        referenceRecord: { ...options.referenceRecord, ...referenceRecord },
    };
    const { url, properties, headers } = endpoint;
    options.logger?.debug?.(`${debugId} Resolving endpoint from template: ${toDebugString(endpoint)}`);
    return {
        ...(headers != undefined && {
            headers: getEndpointHeaders(headers, endpointRuleOptions),
        }),
        ...(properties != undefined && {
            properties: getEndpointProperties(properties, endpointRuleOptions),
        }),
        url: getEndpointUrl(url, endpointRuleOptions),
    };
};

export { evaluateEndpointRule };
//# sourceMappingURL=evaluateEndpointRule.js.map
