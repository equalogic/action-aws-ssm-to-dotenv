{"version":3,"file":"main.js","sources":["../../../../../node_modules/@fastify/busboy/lib/main.js"],"sourcesContent":["'use strict'\n\nconst WritableStream = require('node:stream').Writable\nconst { inherits } = require('node:util')\nconst Dicer = require('../deps/dicer/lib/Dicer')\n\nconst MultipartParser = require('./types/multipart')\nconst UrlencodedParser = require('./types/urlencoded')\nconst parseParams = require('./utils/parseParams')\n\nfunction Busboy (opts) {\n  if (!(this instanceof Busboy)) { return new Busboy(opts) }\n\n  if (typeof opts !== 'object') {\n    throw new TypeError('Busboy expected an options-Object.')\n  }\n  if (typeof opts.headers !== 'object') {\n    throw new TypeError('Busboy expected an options-Object with headers-attribute.')\n  }\n  if (typeof opts.headers['content-type'] !== 'string') {\n    throw new TypeError('Missing Content-Type-header.')\n  }\n\n  const {\n    headers,\n    ...streamOptions\n  } = opts\n\n  this.opts = {\n    autoDestroy: false,\n    ...streamOptions\n  }\n  WritableStream.call(this, this.opts)\n\n  this._done = false\n  this._parser = this.getParserByHeaders(headers)\n  this._finished = false\n}\ninherits(Busboy, WritableStream)\n\nBusboy.prototype.emit = function (ev) {\n  if (ev === 'finish') {\n    if (!this._done) {\n      this._parser?.end()\n      return\n    } else if (this._finished) {\n      return\n    }\n    this._finished = true\n  }\n  WritableStream.prototype.emit.apply(this, arguments)\n}\n\nBusboy.prototype.getParserByHeaders = function (headers) {\n  const parsed = parseParams(headers['content-type'])\n\n  const cfg = {\n    defCharset: this.opts.defCharset,\n    fileHwm: this.opts.fileHwm,\n    headers,\n    highWaterMark: this.opts.highWaterMark,\n    isPartAFile: this.opts.isPartAFile,\n    limits: this.opts.limits,\n    parsedConType: parsed,\n    preservePath: this.opts.preservePath\n  }\n\n  if (MultipartParser.detect.test(parsed[0])) {\n    return new MultipartParser(this, cfg)\n  }\n  if (UrlencodedParser.detect.test(parsed[0])) {\n    return new UrlencodedParser(this, cfg)\n  }\n  throw new Error('Unsupported Content-Type.')\n}\n\nBusboy.prototype._write = function (chunk, encoding, cb) {\n  this._parser.write(chunk, cb)\n}\n\nmodule.exports = Busboy\nmodule.exports.default = Busboy\nmodule.exports.Busboy = Busboy\n\nmodule.exports.Dicer = Dicer\n"],"names":["require$$2","require$$3","require$$4","require$$5","mainModule"],"mappings":"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","x_google_ignoreList":[0]}