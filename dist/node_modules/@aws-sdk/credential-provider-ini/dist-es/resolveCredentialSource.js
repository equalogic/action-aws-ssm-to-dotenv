import { CredentialsProviderError } from '../../../@smithy/property-provider/dist-es/CredentialsProviderError.js';
import { chain } from '../../../@smithy/property-provider/dist-es/chain.js';
import { setCredentialFeature } from '../../core/dist-es/submodules/client/setCredentialFeature.js';

const resolveCredentialSource = (credentialSource, profileName, logger) => {
    const sourceProvidersMap = {
        EcsContainer: async (options) => {
            const { fromHttp } = await import('../../credential-provider-http/dist-es/index.js');
            const { fromContainerMetadata } = await import('../../../@smithy/credential-provider-imds/dist-es/index.js');
            logger?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer");
            return async () => chain(fromHttp(options ?? {}), fromContainerMetadata(options))().then(setNamedProvider);
        },
        Ec2InstanceMetadata: async (options) => {
            logger?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");
            const { fromInstanceMetadata } = await import('../../../@smithy/credential-provider-imds/dist-es/index.js');
            return async () => fromInstanceMetadata(options)().then(setNamedProvider);
        },
        Environment: async (options) => {
            logger?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");
            const { fromEnv } = await import('../../credential-provider-env/dist-es/index.js');
            return async () => fromEnv(options)().then(setNamedProvider);
        },
    };
    if (credentialSource in sourceProvidersMap) {
        return sourceProvidersMap[credentialSource];
    }
    else {
        throw new CredentialsProviderError(`Unsupported credential source in profile ${profileName}. Got ${credentialSource}, ` +
            `expected EcsContainer or Ec2InstanceMetadata or Environment.`, { logger });
    }
};
const setNamedProvider = (creds) => setCredentialFeature(creds, "CREDENTIALS_PROFILE_NAMED_PROVIDER", "p");

export { resolveCredentialSource };
//# sourceMappingURL=resolveCredentialSource.js.map
