{"version":3,"file":"resolveAssumeRoleCredentials.js","sources":["../../../../../node_modules/@aws-sdk/credential-provider-ini/dist-es/resolveAssumeRoleCredentials.js"],"sourcesContent":["import { setCredentialFeature } from \"@aws-sdk/core/client\";\nimport { CredentialsProviderError } from \"@smithy/property-provider\";\nimport { getProfileName } from \"@smithy/shared-ini-file-loader\";\nimport { resolveCredentialSource } from \"./resolveCredentialSource\";\nimport { resolveProfileData } from \"./resolveProfileData\";\nexport const isAssumeRoleProfile = (arg, { profile = \"default\", logger } = {}) => {\n    return (Boolean(arg) &&\n        typeof arg === \"object\" &&\n        typeof arg.role_arn === \"string\" &&\n        [\"undefined\", \"string\"].indexOf(typeof arg.role_session_name) > -1 &&\n        [\"undefined\", \"string\"].indexOf(typeof arg.external_id) > -1 &&\n        [\"undefined\", \"string\"].indexOf(typeof arg.mfa_serial) > -1 &&\n        (isAssumeRoleWithSourceProfile(arg, { profile, logger }) || isCredentialSourceProfile(arg, { profile, logger })));\n};\nconst isAssumeRoleWithSourceProfile = (arg, { profile, logger }) => {\n    const withSourceProfile = typeof arg.source_profile === \"string\" && typeof arg.credential_source === \"undefined\";\n    if (withSourceProfile) {\n        logger?.debug?.(`    ${profile} isAssumeRoleWithSourceProfile source_profile=${arg.source_profile}`);\n    }\n    return withSourceProfile;\n};\nconst isCredentialSourceProfile = (arg, { profile, logger }) => {\n    const withProviderProfile = typeof arg.credential_source === \"string\" && typeof arg.source_profile === \"undefined\";\n    if (withProviderProfile) {\n        logger?.debug?.(`    ${profile} isCredentialSourceProfile credential_source=${arg.credential_source}`);\n    }\n    return withProviderProfile;\n};\nexport const resolveAssumeRoleCredentials = async (profileName, profiles, options, visitedProfiles = {}) => {\n    options.logger?.debug(\"@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)\");\n    const profileData = profiles[profileName];\n    const { source_profile, region } = profileData;\n    if (!options.roleAssumer) {\n        const { getDefaultRoleAssumer } = await import(\"@aws-sdk/nested-clients/sts\");\n        options.roleAssumer = getDefaultRoleAssumer({\n            ...options.clientConfig,\n            credentialProviderLogger: options.logger,\n            parentClientConfig: {\n                ...options?.parentClientConfig,\n                region: region ?? options?.parentClientConfig?.region,\n            },\n        }, options.clientPlugins);\n    }\n    if (source_profile && source_profile in visitedProfiles) {\n        throw new CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile` +\n            ` ${getProfileName(options)}. Profiles visited: ` +\n            Object.keys(visitedProfiles).join(\", \"), { logger: options.logger });\n    }\n    options.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${source_profile ? `source_profile=[${source_profile}]` : `profile=[${profileName}]`}`);\n    const sourceCredsProvider = source_profile\n        ? resolveProfileData(source_profile, profiles, options, {\n            ...visitedProfiles,\n            [source_profile]: true,\n        }, isCredentialSourceWithoutRoleArn(profiles[source_profile] ?? {}))\n        : (await resolveCredentialSource(profileData.credential_source, profileName, options.logger)(options))();\n    if (isCredentialSourceWithoutRoleArn(profileData)) {\n        return sourceCredsProvider.then((creds) => setCredentialFeature(creds, \"CREDENTIALS_PROFILE_SOURCE_PROFILE\", \"o\"));\n    }\n    else {\n        const params = {\n            RoleArn: profileData.role_arn,\n            RoleSessionName: profileData.role_session_name || `aws-sdk-js-${Date.now()}`,\n            ExternalId: profileData.external_id,\n            DurationSeconds: parseInt(profileData.duration_seconds || \"3600\", 10),\n        };\n        const { mfa_serial } = profileData;\n        if (mfa_serial) {\n            if (!options.mfaCodeProvider) {\n                throw new CredentialsProviderError(`Profile ${profileName} requires multi-factor authentication, but no MFA code callback was provided.`, { logger: options.logger, tryNextLink: false });\n            }\n            params.SerialNumber = mfa_serial;\n            params.TokenCode = await options.mfaCodeProvider(mfa_serial);\n        }\n        const sourceCreds = await sourceCredsProvider;\n        return options.roleAssumer(sourceCreds, params).then((creds) => setCredentialFeature(creds, \"CREDENTIALS_PROFILE_SOURCE_PROFILE\", \"o\"));\n    }\n};\nconst isCredentialSourceWithoutRoleArn = (section) => {\n    return !section.role_arn && !!section.credential_source;\n};\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}