{"version":3,"file":"index.js","sources":["../../../../../node_modules/@aws-sdk/middleware-recursion-detection/dist-es/index.js"],"sourcesContent":["import { HttpRequest } from \"@smithy/protocol-http\";\nconst TRACE_ID_HEADER_NAME = \"X-Amzn-Trace-Id\";\nconst ENV_LAMBDA_FUNCTION_NAME = \"AWS_LAMBDA_FUNCTION_NAME\";\nconst ENV_TRACE_ID = \"_X_AMZN_TRACE_ID\";\nexport const recursionDetectionMiddleware = (options) => (next) => async (args) => {\n    const { request } = args;\n    if (!HttpRequest.isInstance(request) || options.runtime !== \"node\") {\n        return next(args);\n    }\n    const traceIdHeader = Object.keys(request.headers ?? {}).find((h) => h.toLowerCase() === TRACE_ID_HEADER_NAME.toLowerCase()) ??\n        TRACE_ID_HEADER_NAME;\n    if (request.headers.hasOwnProperty(traceIdHeader)) {\n        return next(args);\n    }\n    const functionName = process.env[ENV_LAMBDA_FUNCTION_NAME];\n    const traceId = process.env[ENV_TRACE_ID];\n    const nonEmptyString = (str) => typeof str === \"string\" && str.length > 0;\n    if (nonEmptyString(functionName) && nonEmptyString(traceId)) {\n        request.headers[TRACE_ID_HEADER_NAME] = traceId;\n    }\n    return next({\n        ...args,\n        request,\n    });\n};\nexport const addRecursionDetectionMiddlewareOptions = {\n    step: \"build\",\n    tags: [\"RECURSION_DETECTION\"],\n    name: \"recursionDetectionMiddleware\",\n    override: true,\n    priority: \"low\",\n};\nexport const getRecursionDetectionPlugin = (options) => ({\n    applyToStack: (clientStack) => {\n        clientStack.add(recursionDetectionMiddleware(options), addRecursionDetectionMiddlewareOptions);\n    },\n});\n"],"names":[],"mappings":";;;;;;;;;AACA,MAAM,oBAAoB,GAAG,iBAAiB;AAC9C,MAAM,wBAAwB,GAAG,0BAA0B;AAC3D,MAAM,YAAY,GAAG,kBAAkB;AAC3B,MAAC,4BAA4B,GAAG,CAAC,OAAO,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK;AACnF,IAAI,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI;AAC5B,IAAI,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,OAAO,CAAC,OAAO,KAAK,MAAM,EAAE;AACxE,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC;AACzB,IAAI;AACJ,IAAI,MAAM,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,KAAK,oBAAoB,CAAC,WAAW,EAAE,CAAC;AAChI,QAAQ,oBAAoB;AAC5B,IAAI,IAAI,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,aAAa,CAAC,EAAE;AACvD,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC;AACzB,IAAI;AACJ,IAAI,MAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC;AAC9D,IAAI,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;AAC7C,IAAI,MAAM,cAAc,GAAG,CAAC,GAAG,KAAK,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC;AAC7E,IAAI,IAAI,cAAc,CAAC,YAAY,CAAC,IAAI,cAAc,CAAC,OAAO,CAAC,EAAE;AACjE,QAAQ,OAAO,CAAC,OAAO,CAAC,oBAAoB,CAAC,GAAG,OAAO;AACvD,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC;AAChB,QAAQ,GAAG,IAAI;AACf,QAAQ,OAAO;AACf,KAAK,CAAC;AACN;AACY,MAAC,sCAAsC,GAAG;AACtD,IAAI,IAAI,EAAE,OAAO;AACjB,IAAI,IAAI,EAAE,CAAC,qBAAqB,CAAC;AACjC,IAAI,IAAI,EAAE,8BAA8B;AACxC,IAAI,QAAQ,EAAE,IAAI;AAClB,IAAI,QAAQ,EAAE,KAAK;AACnB;AACY,MAAC,2BAA2B,GAAG,CAAC,OAAO,MAAM;AACzD,IAAI,YAAY,EAAE,CAAC,WAAW,KAAK;AACnC,QAAQ,WAAW,CAAC,GAAG,CAAC,4BAA4B,CAAC,OAAO,CAAC,EAAE,sCAAsC,CAAC;AACtG,IAAI,CAAC;AACL,CAAC;;;;","x_google_ignoreList":[0]}