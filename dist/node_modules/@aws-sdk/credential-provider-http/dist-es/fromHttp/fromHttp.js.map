{"version":3,"file":"fromHttp.js","sources":["../../../../../../node_modules/@aws-sdk/credential-provider-http/dist-es/fromHttp/fromHttp.js"],"sourcesContent":["import { setCredentialFeature } from \"@aws-sdk/core/client\";\nimport { NodeHttpHandler } from \"@smithy/node-http-handler\";\nimport { CredentialsProviderError } from \"@smithy/property-provider\";\nimport fs from \"fs/promises\";\nimport { checkUrl } from \"./checkUrl\";\nimport { createGetRequest, getCredentials } from \"./requestHelpers\";\nimport { retryWrapper } from \"./retry-wrapper\";\nconst AWS_CONTAINER_CREDENTIALS_RELATIVE_URI = \"AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\";\nconst DEFAULT_LINK_LOCAL_HOST = \"http://169.254.170.2\";\nconst AWS_CONTAINER_CREDENTIALS_FULL_URI = \"AWS_CONTAINER_CREDENTIALS_FULL_URI\";\nconst AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE = \"AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE\";\nconst AWS_CONTAINER_AUTHORIZATION_TOKEN = \"AWS_CONTAINER_AUTHORIZATION_TOKEN\";\nexport const fromHttp = (options = {}) => {\n    options.logger?.debug(\"@aws-sdk/credential-provider-http - fromHttp\");\n    let host;\n    const relative = options.awsContainerCredentialsRelativeUri ?? process.env[AWS_CONTAINER_CREDENTIALS_RELATIVE_URI];\n    const full = options.awsContainerCredentialsFullUri ?? process.env[AWS_CONTAINER_CREDENTIALS_FULL_URI];\n    const token = options.awsContainerAuthorizationToken ?? process.env[AWS_CONTAINER_AUTHORIZATION_TOKEN];\n    const tokenFile = options.awsContainerAuthorizationTokenFile ?? process.env[AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE];\n    const warn = options.logger?.constructor?.name === \"NoOpLogger\" || !options.logger ? console.warn : options.logger.warn;\n    if (relative && full) {\n        warn(\"@aws-sdk/credential-provider-http: \" +\n            \"you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri.\");\n        warn(\"awsContainerCredentialsFullUri will take precedence.\");\n    }\n    if (token && tokenFile) {\n        warn(\"@aws-sdk/credential-provider-http: \" +\n            \"you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile.\");\n        warn(\"awsContainerAuthorizationToken will take precedence.\");\n    }\n    if (full) {\n        host = full;\n    }\n    else if (relative) {\n        host = `${DEFAULT_LINK_LOCAL_HOST}${relative}`;\n    }\n    else {\n        throw new CredentialsProviderError(`No HTTP credential provider host provided.\nSet AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.`, { logger: options.logger });\n    }\n    const url = new URL(host);\n    checkUrl(url, options.logger);\n    const requestHandler = new NodeHttpHandler({\n        requestTimeout: options.timeout ?? 1000,\n        connectionTimeout: options.timeout ?? 1000,\n    });\n    return retryWrapper(async () => {\n        const request = createGetRequest(url);\n        if (token) {\n            request.headers.Authorization = token;\n        }\n        else if (tokenFile) {\n            request.headers.Authorization = (await fs.readFile(tokenFile)).toString();\n        }\n        try {\n            const result = await requestHandler.handle(request);\n            return getCredentials(result.response).then((creds) => setCredentialFeature(creds, \"CREDENTIALS_HTTP\", \"z\"));\n        }\n        catch (e) {\n            throw new CredentialsProviderError(String(e), { logger: options.logger });\n        }\n    }, options.maxRetries ?? 3, options.timeout ?? 1000);\n};\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}