{"version":3,"file":"fromSSO.js","sources":["../../../../../node_modules/@aws-sdk/credential-provider-sso/dist-es/fromSSO.js"],"sourcesContent":["import { CredentialsProviderError } from \"@smithy/property-provider\";\nimport { getProfileName, loadSsoSessionData, parseKnownFiles } from \"@smithy/shared-ini-file-loader\";\nimport { isSsoProfile } from \"./isSsoProfile\";\nimport { resolveSSOCredentials } from \"./resolveSSOCredentials\";\nimport { validateSsoProfile } from \"./validateSsoProfile\";\nexport const fromSSO = (init = {}) => async ({ callerClientConfig } = {}) => {\n    init.logger?.debug(\"@aws-sdk/credential-provider-sso - fromSSO\");\n    const { ssoStartUrl, ssoAccountId, ssoRegion, ssoRoleName, ssoSession } = init;\n    const { ssoClient } = init;\n    const profileName = getProfileName({\n        profile: init.profile ?? callerClientConfig?.profile,\n    });\n    if (!ssoStartUrl && !ssoAccountId && !ssoRegion && !ssoRoleName && !ssoSession) {\n        const profiles = await parseKnownFiles(init);\n        const profile = profiles[profileName];\n        if (!profile) {\n            throw new CredentialsProviderError(`Profile ${profileName} was not found.`, { logger: init.logger });\n        }\n        if (!isSsoProfile(profile)) {\n            throw new CredentialsProviderError(`Profile ${profileName} is not configured with SSO credentials.`, {\n                logger: init.logger,\n            });\n        }\n        if (profile?.sso_session) {\n            const ssoSessions = await loadSsoSessionData(init);\n            const session = ssoSessions[profile.sso_session];\n            const conflictMsg = ` configurations in profile ${profileName} and sso-session ${profile.sso_session}`;\n            if (ssoRegion && ssoRegion !== session.sso_region) {\n                throw new CredentialsProviderError(`Conflicting SSO region` + conflictMsg, {\n                    tryNextLink: false,\n                    logger: init.logger,\n                });\n            }\n            if (ssoStartUrl && ssoStartUrl !== session.sso_start_url) {\n                throw new CredentialsProviderError(`Conflicting SSO start_url` + conflictMsg, {\n                    tryNextLink: false,\n                    logger: init.logger,\n                });\n            }\n            profile.sso_region = session.sso_region;\n            profile.sso_start_url = session.sso_start_url;\n        }\n        const { sso_start_url, sso_account_id, sso_region, sso_role_name, sso_session } = validateSsoProfile(profile, init.logger);\n        return resolveSSOCredentials({\n            ssoStartUrl: sso_start_url,\n            ssoSession: sso_session,\n            ssoAccountId: sso_account_id,\n            ssoRegion: sso_region,\n            ssoRoleName: sso_role_name,\n            ssoClient: ssoClient,\n            clientConfig: init.clientConfig,\n            parentClientConfig: init.parentClientConfig,\n            profile: profileName,\n        });\n    }\n    else if (!ssoStartUrl || !ssoAccountId || !ssoRegion || !ssoRoleName) {\n        throw new CredentialsProviderError(\"Incomplete configuration. The fromSSO() argument hash must include \" +\n            '\"ssoStartUrl\", \"ssoAccountId\", \"ssoRegion\", \"ssoRoleName\"', { tryNextLink: false, logger: init.logger });\n    }\n    else {\n        return resolveSSOCredentials({\n            ssoStartUrl,\n            ssoSession,\n            ssoAccountId,\n            ssoRegion,\n            ssoRoleName,\n            ssoClient,\n            clientConfig: init.clientConfig,\n            parentClientConfig: init.parentClientConfig,\n            profile: profileName,\n        });\n    }\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAKY,MAAC,OAAO,GAAG,CAAC,IAAI,GAAG,EAAE,KAAK,OAAO,EAAE,kBAAkB,EAAE,GAAG,EAAE,KAAK;AAC7E,IAAI,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,4CAA4C,CAAC;AACpE,IAAI,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,SAAS,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAI;AAClF,IAAI,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI;AAC9B,IAAI,MAAM,WAAW,GAAG,cAAc,CAAC;AACvC,QAAQ,OAAO,EAAE,IAAI,CAAC,OAAO,IAAI,kBAAkB,EAAE,OAAO;AAC5D,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC,WAAW,IAAI,CAAC,UAAU,EAAE;AACpF,QAAQ,MAAM,QAAQ,GAAG,MAAM,eAAe,CAAC,IAAI,CAAC;AACpD,QAAQ,MAAM,OAAO,GAAG,QAAQ,CAAC,WAAW,CAAC;AAC7C,QAAQ,IAAI,CAAC,OAAO,EAAE;AACtB,YAAY,MAAM,IAAI,wBAAwB,CAAC,CAAC,QAAQ,EAAE,WAAW,CAAC,eAAe,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;AAChH,QAAQ;AACR,QAAQ,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE;AACpC,YAAY,MAAM,IAAI,wBAAwB,CAAC,CAAC,QAAQ,EAAE,WAAW,CAAC,wCAAwC,CAAC,EAAE;AACjH,gBAAgB,MAAM,EAAE,IAAI,CAAC,MAAM;AACnC,aAAa,CAAC;AACd,QAAQ;AACR,QAAQ,IAAI,OAAO,EAAE,WAAW,EAAE;AAClC,YAAY,MAAM,WAAW,GAAG,MAAM,kBAAkB,CAAC,IAAI,CAAC;AAC9D,YAAY,MAAM,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,WAAW,CAAC;AAC5D,YAAY,MAAM,WAAW,GAAG,CAAC,2BAA2B,EAAE,WAAW,CAAC,iBAAiB,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;AAClH,YAAY,IAAI,SAAS,IAAI,SAAS,KAAK,OAAO,CAAC,UAAU,EAAE;AAC/D,gBAAgB,MAAM,IAAI,wBAAwB,CAAC,CAAC,sBAAsB,CAAC,GAAG,WAAW,EAAE;AAC3F,oBAAoB,WAAW,EAAE,KAAK;AACtC,oBAAoB,MAAM,EAAE,IAAI,CAAC,MAAM;AACvC,iBAAiB,CAAC;AAClB,YAAY;AACZ,YAAY,IAAI,WAAW,IAAI,WAAW,KAAK,OAAO,CAAC,aAAa,EAAE;AACtE,gBAAgB,MAAM,IAAI,wBAAwB,CAAC,CAAC,yBAAyB,CAAC,GAAG,WAAW,EAAE;AAC9F,oBAAoB,WAAW,EAAE,KAAK;AACtC,oBAAoB,MAAM,EAAE,IAAI,CAAC,MAAM;AACvC,iBAAiB,CAAC;AAClB,YAAY;AACZ,YAAY,OAAO,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU;AACnD,YAAY,OAAO,CAAC,aAAa,GAAG,OAAO,CAAC,aAAa;AACzD,QAAQ;AACR,QAAQ,MAAM,EAAE,aAAa,EAAE,cAAc,EAAE,UAAU,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG,kBAAkB,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC;AAClI,QAAQ,OAAO,qBAAqB,CAAC;AACrC,YAAY,WAAW,EAAE,aAAa;AACtC,YAAY,UAAU,EAAE,WAAW;AACnC,YAAY,YAAY,EAAE,cAAc;AACxC,YAAY,SAAS,EAAE,UAAU;AACjC,YAAY,WAAW,EAAE,aAAa;AACtC,YAAY,SAAS,EAAE,SAAS;AAChC,YAAY,YAAY,EAAE,IAAI,CAAC,YAAY;AAC3C,YAAY,kBAAkB,EAAE,IAAI,CAAC,kBAAkB;AACvD,YAAY,OAAO,EAAE,WAAW;AAChC,SAAS,CAAC;AACV,IAAI;AACJ,SAAS,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC,WAAW,EAAE;AAC1E,QAAQ,MAAM,IAAI,wBAAwB,CAAC,qEAAqE;AAChH,YAAY,2DAA2D,EAAE,EAAE,WAAW,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;AACrH,IAAI;AACJ,SAAS;AACT,QAAQ,OAAO,qBAAqB,CAAC;AACrC,YAAY,WAAW;AACvB,YAAY,UAAU;AACtB,YAAY,YAAY;AACxB,YAAY,SAAS;AACrB,YAAY,WAAW;AACvB,YAAY,SAAS;AACrB,YAAY,YAAY,EAAE,IAAI,CAAC,YAAY;AAC3C,YAAY,kBAAkB,EAAE,IAAI,CAAC,kBAAkB;AACvD,YAAY,OAAO,EAAE,WAAW;AAChC,SAAS,CAAC;AACV,IAAI;AACJ;;;;","x_google_ignoreList":[0]}